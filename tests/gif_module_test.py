from unittest.mock import AsyncMock

from idotmatrix.modules.gif import GifModule
from idotmatrix.screensize import ScreenSize
from tests import TestBase


class TestGifModule(TestBase):

    async def test_upload_gif_file(self):
        # GIVEN
        connection_manager = AsyncMock()
        under_test = GifModule(
            connection_manager=connection_manager,
            screen_size=ScreenSize.SIZE_64x64,
        )

        gif_file_path = self._test_data_folder / "demo.gif"

        # WHEN
        await under_test.upload_gif_file(
            file_path=gif_file_path,
        )

        # THEN
        # TODO: this is the old implementation, should be replaced with the new one when its ready
        connection_manager.send_bytes.assert_awaited_once_with(
            data=bytearray(
                b'\xc3\t\x01\x00\x00\xb3\t\x00\x00\xf47k\xb9\x05\x00\rGIF89a@\x00@\x00\x83\x00\x00\x00\x00\x00\xff\x95\x00>\'#\xff\xc1\x07mLA\xfff\x00yUHijj]@7YVRN4.\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00!\xff\x0bNETSCAPE2.0\x03\x01\x00\x00\x00!\xf9\x04\x08\n\x00\x00\x00,\x00\x00\x00\x00@\x00@\x00\x00\x08\xff\x00\x01\x08\x1cH\xb0\xa0\xc1\x83\x08\x13*\\\xc8\xb0\xa1\xc3\x87\x10#J\x9cH\xb1\xa2\xc5\x8b\x183j\xdc\xc8\xb1\xa3\xc7\x8f C\x8a\x1cIR`\x81\x02%3\x9eL\x89\xf1\xe4J\x96\x14]\xa2\x84\x19\xf1d\x80\x002i>\xb4\x89\xd3\xa5N\x87<o\xde|\xf93aP\xa1D\x8b\x16<*\x14\xe9L\xa5\x03\x996\xed\t\x95\xe0\xd1\x01\x03\xa6R\xadz5\xeb\xd4\xa4:\xbbb\xc5\xaa\x15,K\xb1c\xcb>=[@\xeb\xd8\xb7^\x9b\x9a\x15)\x15n\xda\xafkI\xa2\xb5\xab\xf5&\xcc\xbdp\xfb\x06\x80\xe9\xd6\xee]\xad\x84\xa7\x1a><Ug\xe1\xb7\x82\x8b>f\xdc\xb4\xa8\x00\x01\x062k\xde\xcc\xd9\xc0e\xcb\x98;\x8b\xce\xfc\xf9\xe7\xe5\xd1\xa3K\xeb<\x8d\xba\xb3j\xd3\x02\x08\xc8\x9eM[\xf6k\xd0\xb5s\x13\xb8\r[wm\xde\xabc\xfb\x9e\r\x9c\xe6\xe5\xe1\xc4\x05T\x05p\x1c\xf9n\xe5?\x13HOp\xa0\xba\xf5\xeb\xd8\x0fLO\x00s{\xf6\xef\xd6\xb7w[\x9f\x0e\x1e\xbcx\x96\xde\xcbg?\x0f\x1a\x81\xfb\xf7\xee\x8b\xb7\x87\xff^>l\xfa\xf5\xa1/\x17x\x19\x7f|\xfd\xfb\xf5\xe7\x9f}\xc1\xf9\x87\x00\x81\xb0)\xa0\xa0\x02\x08\x82\xb6 \x83\x00\xee7\xd0e\x0f6\x98\xe0\x82\x16\x06Wa\x84\x122\'\xc0\x86\x1d\x1etY\x86J\x8d\xc8a\x88(\xa6\xa8\xe2\x8a\n\x05\x04\x00!\xf9\x04\x08\n\x00\x00\x00,\x00\x00\x00\x00@\x00@\x00\x83\x00\x00\x00\xff\x95\x00>\'#mLA\xff\xc1\x07\xfff\x00yUHijj]@7YVRN4.\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xff\x00\x01\x08\x1cH\xb0\xa0\xc1\x83\x08\x13*\\\xc8\xb0\xa1\xc3\x87\x10#J\x9cH\xb1\xa2\xc5\x8b\x183j\xdc\xc8\xb1\xa3\xc7\x8f C\x8a\x1cI\x92`\x81\x02%3\x9eL\x89\xf1\xe4J\x96\x14]\xa2\x84\x19\xf1d\x80\x9b\x01^\xd2lh\x13\xa7\xce\x9d\t{\xe2\xf49\x13\xe8A\xa1Cs\x165Z\x10\xe9\xd0\x9fL\x07:%\x1a\xd5d\x81\xa4X\x95V\x050\x15+T\x9a]\x03\x10 \xe0u)\xcc\xb0c\xcb\x1a\x9d:\xb6-\xd9\xa4_I\xb2u\xfb\xf6\xa9\xd9\x91s\xe9\xb6\xb5{\xf6jR\xbdn\xf9\xb2\xc4\nxoV\x98\x84\x0b\xd7M\xba3\xb1^\xacF\x1d\xd3\x85\x0cT\x80\x00\x03\x983k\xdel\xc0\xb2Q\xcb\x9cCg\xf6\\\xf9\xb2\xe8\xd0\xa4w\x82>\xcd9u\xe9\x01\xb0c\xcb\x86\xed\xfa\xb3\x80\xd9\xb8\x07\xd4~\x9d[\xf6n\xd5\xb7{\xc7\xfeM\xd3\xb2\xf0\xe1\x02\xb6\x1a?\xae;9\xd0\x04\xd0\x13\x1c\x98N\xbd\xba\xf5\x03\xd1\x13\xc0\xcc~\xbd;\xf5\xec\xdb\xa3{X\xf7\x0e\x9e%\xf7\xf1\xd7\xcb\xdbF\xc0\xbe={\xe2\xeb\xdd\xb7\x87_Z\xfe|\xe7[\x05Z\xb6\xff\x1e\x7f\xfe\xfd\xfc\xd1\x07\x1c\x7f\x08\x08X\x9a\x02\x08*`\xa0m\t*\xe8_~\x03Y\xd6\xe0\x82\x07&H!p\x13>\x08!\x00\x12Z\xa8\xe1\x86\x1cZ\xf6!\x88!^H\xe2\x89(\xa6Hb@\x00!\xf9\x04\x08\n\x00\x00\x00,\x00\x00\x00\x00@\x00@\x00\x83\x00\x00\x00\xff\x95\x00>\'#mLA\xfff\x00\xff\xc1\x07yUHijj]@7YVRN4.\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xff\x00\x01\x08\x1cH\xb0\xa0\xc1\x83\x08\x13*\\\xc8\xb0\xa1\xc3\x87\x10#J\x9cH\xb1\xa2\xc5\x8b\x183j\xdc\xc8\xb1\xa3\xc7\x8f C\x8a\x1cI\x12!\x01\x02%3\x9eLi\xf1\xe4J\x96\x14]\xa2\x84\x19\xf1d\x80\x9b\x01^\xd2lh\x13\xa7\xce\x9d\t{\xe2\xcc9\x13hP\x02Co\xfe4jPh\xd2\xa5L\x05:\x1d\n\xd5\xe8\xd4\xa4J\x8b2\xbd\x8a\xb5*M\xa7\x05\xc2\x16\xe8\xaau\'X\xb1d\xad"\xc5)\x16\xed\xd3\xb2,\xcf\xb6M\xfbu\xed\xcd\xb6x\xc7\xfa\x84KRn^\xbdYwb\xfd\xeb60\xcd\xc1\x84\x01\x13\x15\x8c5@^\xacF\x1b;\xc6\x0b\x19\xa8\x00\x01\x062k\xde\xcc\xd9\xc0e\xa3\x97;\x8b\xd6\xfc\xd92\xe6\xd1\xa2K\xef\x0c\x8d\xba\xb3j\xd3\x03b\xcb\x9e\x1d\xfb5h\x01\xb4s\x0f\xb0\r[\xf7l\xde\xabq\xfb\x96\r\x9c\xe6\xe5\xe1\xc4\x05D\x15x\x1c\xf9n\xe5@\x13HOp\xa0\xba\xf5\xeb\xd8\x0fLO\x00s{\xf6\xef\xd6\xb7w[\x9f\x0e\x1e\xbcx\x96\xde\xcbg?\x7f\x1b\x81\xfb\xf7\xee\x8b\xb7\x87\xff^\xbei\xfa\xf5\xa1/\x1fx\x19\x7f|\xfd\xfb\x01\xd0\x9f\x7f\xf6\x05\xe7\x1f\x02\x05\x9a\xa6\xc0\x82\n$x\x1b\x83\r\x02\x18 \x7f\x02@\xe8\xa0\x82\x0c^\x18\x9c\x85\x12N(`\x85\x19v\xe8\xe1\x87\x1a2uY\x89#\xa6\xa8\xe2\x8a,\x06\x04\x00!\xf9\x04\x08\n\x00\x00\x00,\x00\x00\x00\x00@\x00@\x00\x83\x00\x00\x00\xff\x95\x00>\'#mLAyUHijj\xfff\x00\xff\xc1\x07]@7YVRN4.\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xff\x00\x01\x08\x1cH\xb0\xa0\xc1\x83\x08\x13*\\\xc8\xb0\xa1\xc3\x87\x10#J\x9cH\xb1\xa2\xc5\x8b\x183j\xdc\xc8\xb1\xa3\xc7\x8f C\x8a\x1cI\xb2\xa4\xc9\x93\x16\r\x18@\x99r%K\x89*U\xbe\x84\x19s\xe6C\x95\x01r\x06\x90is!N\x9d<{&\xfc\x993\xa8\xd0\x83Dw\xba<Z0\xa9N\xa5L\t:\x05\xba\xf4\xe8\xd4\xa7E\xab\xda\xbc\x8a\xd5\xe8V\x03O\x0f\x88=\xf0\xd4\xeb\xcc\xa4c\xc9R\x15\x8a6\xad\xda\xacl\xc1\xeat\xfb\x16\xeaY\xb99\xe9\xa6}\xfa5\xac^\xb1|gb\r\xf0w\xb0\xcd\xc1\x85\xb1\xda\x14 \x80\x80\xe3\xc7\x90#\x13`\xbc\xb8\xb1\xe4\xcb\x8e)\xcfd\x8c\x19\xb3\xe6\x97\x9c;K\xfe\xbcY\xc0\x80\xd3\xa8S\x9f&]Y\xb5\xeb\x01\xacK\xbfV\x1d\x1b\xb4\xe9\xd9\xa8k\xb3d\x8c;\xb7\x00\xa6\xbc{\xc3\xfe=3\x81\xf1\x04\x05\x92+_\xce\xbc\xc0\xf1\x04(\x9f7\x9f\xae\xfcy\xf4\xe3\xd4\xa9[?)={\xf3\xed\x95\x11\x88K\x1f/^wx\xf2\xe3\xcd\x97F\x9f\x9exT\x00\x8c\xd9\x97w\x1f5\xbe|\xf5\xb6\xe5#\xc0_Z\x81\x7f\x05\xfcU\xf6\x1f\x80\xf4\xbd\'\x10c\x03\x06\xd8\xdf\x7f\n\xda\x96`\x81\x06"\xc8 \x84\x06\xc2\xc7\x18\x85\x15Z\xd8`\x86\x1cv\xe8a\x86\x01\x01\x00!\xf9\x04\x08\n\x00\x00\x00,\x00\x00\x00\x00@\x00@\x00\x83\x00\x00\x00\xff\x95\x00>\'#mLA\xff\xc1\x07yUHijj\xfff\x00]@7YVRN4.\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xff\x00\x01\x08\x1cH\xb0\xa0\xc1\x83\x08\x13*\\\xc8\xb0\xa1\xc3\x87\x10#J\x9cH\xb1\xa2\xc5\x8b\x183j\xdc\xc8\xb1\xa3\xc7\x8f C\x8a\x1cI\xb2\xa4\xc9\x93\x12\x0f\x1c@iQ%\xcb\x8a*]\xbe\x8c\x18s\xe5L\x87*\x03\xe8\x0c \xf3\xa6\xc2\x9c;{\xfaD\x08t\'O\x9bC\r\x16\r\x8a4\xa9\xc0\xa5F\x85:\x85\xca\xd4\xe9\xd3\x03Fu\x12 \x10\xb5\xe9M\xaa[\xbbN\xc5\xbask\xd8\xacRY.5\xcb\x15\xad\xd7\x93k\xd9\x9a\x15;3\xae\xdc\xb6:\xd3\x9a4z\x97m\xd6\x007\xf9\xf6=k4p\xd6\xc1\x84\x01\xcf\xfc\x8b\x18\xaf\xe2\x97\x02\x04\x14\x98L\xb9\xb2\xe5\x02\x91oF\xbe\xcc\x99r\xe6\x99\x9b;s\xfe\x0cY\xb2\xe8\xcb\xa4A\x0b\x18\xc0\xba\xb5k\xd6\xa95\xaf~M;\xb6j\xda\xb5\x058\x8d\x8c\xfb\xb5\xed\xd2\xbd]\xfff\xc9;8l\xdd3\x13(O`\xa0\xb9\xf3\xe7\xd0\r,O\x80rz\xf4\xeb\xce\xa7W_\x8e\x1d\xbb\xf6\x93\xd6\xbbGP\xff.\x1b\x81\xf9\xf3\xe6\x87\x97G\x7f^\xbdj\xf6\xed\x91[\x05\x10\x19~z\xf9V\xeb\xdbw_\xda>\x02\xfe\xaa) \xa0\x02\x00\xca6 \x81\xf8\xcd\'Pd\x07\x16\x18\xe0\x80\x0e\x96\xd6`\x82\n2\x08!\x85\n\xd2\x17\x19\x86\x19j\x18a\x87 \x86(b\x87\x01\x01\x00!\xf9\x04\x08\n\x00\x00\x00,\x00\x00\x00\x00@\x00@\x00\x83\x00\x00\x00\xff\x95\x00>\'#mLA\xff\xc1\x07yUHijj\xfff\x00]@7YVRN4.\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xff\x00\x01\x08\x1cH\xb0\xa0\xc1\x83\x08\x13*\\\xc8\xb0\xa1\xc3\x87\x10#J\x9cH\xb1\xa2\xc5\x8b\x183j\xdc\xc8\xb1\xa3\xc7\x8f C\x8a\x1cI\xb2\xa4\xc9\x93\x12\x0f\x1c@iQ%\xcb\x89*]\xbe\x8c\x18s\xe5L\x88*\x03\x04\x90y\x93a\xce\x9d6{&\xfc\xa9S\'O\xa1\x05\x89\x16=\x8a\x14\x80\xd2\xa2K\x83"}\n\x15hS\x81J\t\x10\x80\xca\xb4g\xd6\xadQ\x9bR\xd5\xaa\x95\xab\xd4\x97c\xc9\x9a\x15\xfa\x95\xac\xda\xb03\xdb\xba\x05k\xf4\xecI\xa8s\xf3\xd2\rp\x13\xaf^\xb7P\xfbV\xfd[\x95\xef\xcc\xc2\x84\xab\xde\x14 \xa0\x80\xe3\xc7\x90#\x17`\xbc\xb8\xb1\xe4\xcb\x8e)\xcfd\x8c\x19\xb3\xe6\x97\x9c;K\xfe\xbcY\xc0\x80\xd3\xa8S\x9f&]Y\xb5\xeb\x01\xacK\xbfV\x1d\x1b\xb4\xe9\xd9\xa8k\xb3d\x8c;\xb7\x80\xa6\xbc{\xc3\xfe=3\x81\xf1\x04\x06\x92+_\xce\xdc\xc0\xf1\x04(\x9f7\x9f\xae\xfcy\xf4\xe3\xd4\xa9[?)={\xf3\xed\x95\x11\x88K\x1f/^wx\xf2\xe3\xcd\x97F\x9f\x9e\xf8U\x00\x8c\xd9\x97w\x7f5\xbe|\xf5\xb6\xe5#\xc0_Z\x81\x7f\x05\xfcU\xf6\x1f\x80\xf4\xbd\'\x10c\x03\x06\xd8\xdf\x7f\n\xda\x96`\x81\x06"\xc8 \x84\x06\xc2\xc7\x18\x85\x15Z\xd8`\x86\x1cv\xe8a\x86\x01\x01\x00;'),
            response=True, chunk_size=514
        )
        # TODO: new implementation
        # connection_manager.send_packets.assert_awaited_once_with()
